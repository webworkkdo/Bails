# Vulnerability Report

This document contains a list of vulnerabilities found in the codebase.

## 1. Call Spamming (Denial of Service)

**Impact:** An attacker can repeatedly send call requests to a user, causing their WhatsApp application to become unresponsive and eventually crash. This constitutes a Denial of Service (DoS) attack.

**Steps to Reproduce:**
1. An attacker using this library can call the `offerCall` function in a rapid loop.
2. The library will send a high volume of call stanzas to the victim.
3. The victim's WhatsApp client will be overwhelmed by the incoming call notifications, leading to performance degradation and eventual application crash.

**Vulnerable Code:**
- **File:** `lib/Socket/messages-recv.js`
- **Function:** `offerCall`
- **Issue:** This function does not implement any rate limiting or cooldown mechanism between call offers, allowing for abuse.
- **Function:** `handleCall`
- **Issue:** This function processes incoming call stanzas without checking the frequency of requests from a single user, making it susceptible to spamming attacks.

## 2. Resource Exhaustion via Message Abuse

**Impact:** An attacker can send a high volume of messages or specially crafted malformed messages to exhaust the recipient's device resources, such as CPU and memory. This can cause the WhatsApp application to become slow, unresponsive, or crash.

**Steps to Reproduce:**

**Scenario A: High Volume of Messages**
1. An attacker uses the library to send a large number of messages to the victim in a short period.
2. The victim's client is forced to process all incoming messages, leading to increased CPU and memory consumption.
3. Continuous message flooding will eventually lead to resource exhaustion and application failure.

**Scenario B: Malformed Messages and Retry Storm**
1. An attacker sends a message that is intentionally corrupted or fails decryption checks.
2. The `handleMessage` function on the recipient's client fails to decrypt the message and triggers the `sendRetryRequest` function.
3. The attacker can repeatedly send such messages, forcing the client into a "retry storm," where it continuously requests the server to resend the message, consuming network and processing resources.

**Vulnerable Code:**
- **File:** `lib/Socket/messages-recv.js`
- **Function:** `handleMessage`
- **Issue:** The function lacks proper validation for message size and frequency, making it vulnerable to message flooding attacks.
- **Function:** `sendRetryRequest`
- **Issue:** This function can be triggered repeatedly by malformed messages, creating a resource-intensive retry loop. There is a `maxMsgRetryCount`, but it can be bypassed by sending new malformed messages.

## 3. Group Management Abuse

**Impact:** An attacker with knowledge of the group ID can perform administrative actions without proper authorization. This can lead to disruption of group activities, removal of legitimate members, and spreading of misinformation by altering the group subject or description.

**Steps to Reproduce:**
1. An attacker, who does not need to be an admin of the group, can call the group management functions directly.
2. For example, an attacker could call `groupParticipantsUpdate` to remove a user from the group, `groupUpdateSubject` to change the group's name, or `groupUpdateDescription` to modify the group's description.
3. Since there are no permission checks in these functions, the library will execute these actions without verifying if the user has the necessary admin privileges.

**Vulnerable Code:**
- **File:** `lib/Socket/groups.js`
- **Functions:**
  - `groupParticipantsUpdate`
  - `groupUpdateSubject`
  - `groupUpdateDescription`
- **Issue:** These functions do not verify if the user issuing the request has administrative privileges in the group. They directly execute the requested action, allowing any user to perform admin-level tasks.
